<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><link rel="stylesheet" type="text/css" href="css/normalize.css"><link rel="stylesheet" type="text/css" href="css/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="css/highlightjs/night-owl.css"><link rel="stylesheet" type="text/css" href="index.css"><title>Architecture | bfx-hf-algo</title></head><body><div id="bfx-oss-docs-side-bar"><div id="bfx-oss-docs-side-bar__header"><img src="img/bfx-logo-bg-white.png" alt="Bitfinex" height="63"></div><ul><li><a href="index.html"><p>Home</p></a></li><li><a href="page_md_render_test.html"><p>Markdown Render Test</p></a></li><li><a href="page_libraries_bitfinex_api_py_README.html"><img src="svg/icons/python.svg"><p>bitfinex-api-py</p></a></li><li><a href="page_libraries_bitfinex_api_go_README.html"><img src="svg/icons/go.svg"><p>bitfinex-api-go</p></a></li><li><a href="page_libraries_bfxfixgw_README.html"><img src="svg/icons/go.svg"><p>bfxfixgw</p></a></li><li><a href="page_libraries_bitfinex_api_rb_README.html"><img src="svg/icons/ruby.svg"><p>bitfinex-api-rb</p></a></li><li><a href="page_libraries_bitfinex_api_node_README.html"><img src="svg/icons/nodejs_small.svg"><p>bitfinex-api-node</p></a></li><li><a href="page_libraries_bfx_api_mock_srv_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-mock-srv</p></a></li><li><a href="page_libraries_bfx_api_node_core_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-core</p></a></li><li><a href="page_libraries_bfx_api_node_models_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-models</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_example_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-example</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_managed_candles_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-candles</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_managed_ob_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-managed-ob</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_ob_checksum_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-ob-checksum</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_seq_audit_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-seq-audit</p></a></li><li><a href="page_libraries_bfx_api_node_plugin_wd_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-plugin-wd</p></a></li><li><a href="page_libraries_bfx_api_node_rest_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-rest</p></a></li><li><a href="page_libraries_bfx_api_node_util_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-util</p></a></li><li><a href="page_libraries_bfx_api_node_ws1_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-api-node-ws1</p></a></li><li><a href="page_libraries_bfx_hf_backtest_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-backtest</p></a></li><li><a href="page_libraries_bfx_hf_chart_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-chart</p></a></li><li><a href="page_libraries_bfx_hf_data_server_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-data-server</p></a></li><li><a href="page_libraries_bfx_hf_ext_plugin_bitfinex_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-bitfinex</p></a></li><li><a href="page_libraries_bfx_hf_ext_plugin_dummy_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ext-plugin-dummy</p></a></li><li><a href="page_libraries_bfx_hf_indicators_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-indicators</p></a></li><li><a href="page_libraries_bfx_hf_models_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_lowdb_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-lowdb</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_sql_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-sql</p></a></li><li><a href="page_libraries_bfx_hf_models_adapter_template_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-models-adapter-template</p></a></li><li class="active"><a href="page_libraries_bfx_hf_algo_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-algo</p></a><ul><li><a href="page_libraries_bfx_hf_algo_README.html"><p>- README</p></a></li><li><a href="page_libraries_bfx_hf_algo_reference.html"><p>- API Reference</p></a></li><li class="active"><a href="page_libraries_bfx_hf_algo_tutorial_architecture.html"><p>- Architecture</p></a></li></ul></li><li><a href="page_libraries_bfx_hf_server_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-server</p></a></li><li><a href="page_libraries_bfx_hf_strategy_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-strategy</p></a></li><li><a href="page_libraries_bfx_hf_strategy_exec_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-strategy-exec</p></a></li><li><a href="page_libraries_bfx_hf_ui_config_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-ui-config</p></a></li><li><a href="page_libraries_bfx_hf_util_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-hf-util</p></a></li><li><a href="page_libraries_bfx_ws2_api_audit_README.html"><img src="svg/icons/nodejs_small.svg"><p>bfx-ws2-api-audit</p></a></li><li><a href="page_libraries_cbq_js_README.html"><img src="svg/icons/nodejs_small.svg"><p>cbq-js</p></a></li><li><a href="page_libraries_caron_README.html"><img src="svg/icons/nodejs_small.svg"><p>caron</p></a></li><li><a href="page_libraries_eos_name_verify_README.html"><img src="svg/icons/nodejs_small.svg"><p>eos-name-verify</p></a></li><li><a href="page_libraries_grenache_browser_http_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-browser-http</p></a></li><li><a href="page_libraries_grenache_grape_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-grape</p></a></li><li><a href="page_libraries_grenache_nodejs_base_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-base</p></a></li><li><a href="page_libraries_grenache_nodejs_http_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-http</p></a></li><li><a href="page_libraries_grenache_nodejs_link_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-link</p></a></li><li><a href="page_libraries_grenache_nodejs_utp_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-utp</p></a></li><li><a href="page_libraries_grenache_nodejs_ws_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws</p></a></li><li><a href="page_libraries_grenache_nodejs_ws_tls_README.html"><img src="svg/icons/nodejs_small.svg"><p>grenache-nodejs-ws-tls</p></a></li><li><a href="page_libraries_lib_js_util_currencies_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-currencies</p></a></li><li><a href="page_libraries_lib_js_util_math_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-math</p></a></li><li><a href="page_libraries_lib_js_util_number_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-number</p></a></li><li><a href="page_libraries_lib_js_util_symbol_README.html"><img src="svg/icons/nodejs_small.svg"><p>lib-js-util-symbol</p></a></li><li><a href="page_libraries_smidgen_README.html"><img src="svg/icons/nodejs_small.svg"><p>smidgen</p></a></li><li><a href="page_libraries_sunbeam_README.html"><img src="svg/icons/nodejs_small.svg"><p>sunbeam</p></a></li><li><a href="page_libraries_wasteland_README.html"><img src="svg/icons/nodejs_small.svg"><p>wasteland</p></a></li></ul></div><div id="bfx-oss-docs-content"><div id="bfx-oss-docs-header-bar"><h2>Architecture</h2><h2>bfx-hf-algo</h2></div><div id="bfx-oss-docs-content-wrapper" class="bfx-oss-docs-content-type-api-docs"><div class="bfx-oss-docs-md-content bfx-oss-docs-code-wrapper"><div id="bfx-oss-docs-api-docs-index"><div id="bfx-oss-docs-api-docs-index__inner"><nav class="bfx-oss-docs-md-toc"><ol><li><a href="#ao-host">AO Host</a></li><li><a href="#algo-order-system">Algo Order System</a><ol><li><a href="#ao-event-handlers-%26-helpers">AO Event Handlers &amp; Helpers</a></li><li><a href="#custom-ao-event-handlers">Custom AO Event Handlers</a></li><li><a href="#subscribing-to-data-channels">Subscribing to Data Channels</a></li></ol></li><li><a href="#ping%2Fpong-order-type">Ping/Pong Order Type</a></li><li><a href="#iceberg-order-type">Iceberg Order Type</a></li><li><a href="#twap-order-type">TWAP Order Type</a></li><li><a href="#accumulate%2Fdistribute-order-type">Accumulate/Distribute Order Type</a></li><li><a href="#ma-crossover">MA Crossover</a></li><li><a href="#execution-via-the-bitfinex-ui">Execution via the Bitfinex UI</a></li></ol></nav></div></div><h2 id="ao-host"><a class="header-anchor" href="#ao-host">§</a> AO Host</h2><p>The [<code>AOHost</code>]{@link AOHost} class provides a wrapper around the algo order system, and manages lifetime events/order execution. Internally it utilizes an [<code>AOAdapter</code>]{@link <a href="https://github.com/bitfinexcom/bfx-hf-ext-plugin-bitfinex/blob/master/lib/ao_adapter/index.js">https://github.com/bitfinexcom/bfx-hf-ext-plugin-bitfinex/blob/master/lib/ao_adapter/index.js</a>} instance to communicate with the exchange API, and listens for websocket stream events in order to update order state/trigger algo order events.</p><p>Execution is handled by an event system, with events being triggered by [<code>AOAdapter</code>]{@link <a href="https://github.com/bitfinexcom/bfx-hf-ext-plugin-bitfinex/blob/master/lib/ao_adapter/index.js">https://github.com/bitfinexcom/bfx-hf-ext-plugin-bitfinex/blob/master/lib/ao_adapter/index.js</a>} websocket stream payloads, and the algo orders themselves.</p><p>To start/stop algo orders, [<code>gid = startAO(id, args)</code>]{@link AOHost#startAO} and [<code>stopAO(gid)</code>]{@link AOHost#stopAO} methods are provided, with the generated group ID (<code>gid</code>) being the same as that used for all atomic orders created by the individual algo orders.</p><h2 id="algo-order-system"><a class="header-anchor" href="#algo-order-system">§</a> Algo Order System</h2><p>Algorithmic orders are defined by an ID/Name pair, a set of meta functions describing the order, and a set of event handlers to be triggered during the orders lifetime/execution. A [<code>defineAlgoOrder</code>]{@link defineAlgoOrder} helper is provided to construct the final AO definition object:</p><pre><code class="hljs language-js"><span class="hljs-keyword">const</span> AO = defineAlgoOrder({
  <span class="hljs-attr">id</span>: <span class="hljs-string">'some.ao.identifier'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Descriptive AO Label'</span>,

  <span class="hljs-comment">// meta functions describing the order/execution environment</span>
  <span class="hljs-attr">meta</span>: {
    validateParams,  <span class="hljs-comment">// validates processed parameters</span>
    processParams,   <span class="hljs-comment">// prepares raw parameters for execution</span>
    declareEvents,   <span class="hljs-comment">// declares/hooks up custom internal event handlers</span>
    declareChannels, <span class="hljs-comment">// declares needed data channels, to be managed by the AO host</span>
    getUIDef,        <span class="hljs-comment">// returns the Bitfinex Order Form definition schema</span>
    genOrderLabel,   <span class="hljs-comment">// constructs a label for generated atomic orders</span>
    genPreview,      <span class="hljs-comment">// generates preview orders for rendering in the bfx UI</span>
    initState,       <span class="hljs-comment">// creates the initial AO state object</span>
    serialize,       <span class="hljs-comment">// serializes state for DB persistence</span>
    unserialize,     <span class="hljs-comment">// unserializes loaded DB states for execution</span>
  },

  <span class="hljs-attr">events</span>: {
    <span class="hljs-attr">self</span>: {
      <span class="hljs-comment">// internal events, bound in declareEvents()</span>
    },

    <span class="hljs-attr">life</span>: {
      start, <span class="hljs-comment">// triggered on execution start, should handle initialisation</span>
      stop,  <span class="hljs-comment">// triggered on execution stop, should handle teardown</span>
    },

    <span class="hljs-attr">orders</span>: {
      order_snapshot, <span class="hljs-comment">// triggered upon receival of an account order snapshot</span>
      order_new,      <span class="hljs-comment">// triggered when a new order is opened</span>
      order_update,   <span class="hljs-comment">// triggered when an order is updated</span>
      order_close,    <span class="hljs-comment">// triggered when an order is closed</span>
      order_fill,     <span class="hljs-comment">// triggered on any order fill (order new/update/close)</span>
      order_cancel,   <span class="hljs-comment">// triggered when an order is closed via cancellation</span>
    },

    <span class="hljs-attr">data</span>: {
      managedCandles, <span class="hljs-comment">// triggered by receipt of a managed candle dataset</span>
      managedBook,    <span class="hljs-comment">// triggered by receipt of a managed order book</span>
      notification,   <span class="hljs-comment">// triggered by receipt of a notification</span>
      candles,        <span class="hljs-comment">// triggered by receipt of candles</span>
      ticker,         <span class="hljs-comment">// triggered by receipt of a ticker</span>
      trades,         <span class="hljs-comment">// triggered by receipt of trades</span>
      book,           <span class="hljs-comment">// triggered by receipt of an order book snapshot/update</span>
    },

    <span class="hljs-attr">errors</span>: {
      minimum_size,   <span class="hljs-comment">// triggered when an order fails due to being below the</span>
                      <span class="hljs-comment">// minimum size for its symbol; the AO may need to be stopped</span>
    }
  }
})
</code></pre><h3 id="ao-event-handlers-%26-helpers"><a class="header-anchor" href="#ao-event-handlers-%26-helpers">§</a> AO Event Handlers &amp; Helpers</h3><p>All event handlers receive the same arguments: <code>(instance = {}, ...args)</code>. The instance contains two objects, <code>{ state = {}, h = {} }</code> with <code>state</code> being the current AO state, and <code>h</code> being a helper object.</p><p>The provided helpers are:</p><ul><li><code>debug(str, ...args)</code> - for logging information to the console, tagged by AO GID</li><li><code>emitSelf(eventName, ...args)</code> - triggers an event on the ‘self’ section</li><li><code>emitSelfAsync(eventName, ...args)</code> - same as <code>emitSelf</code> but operates on next tick</li><li><code>emit(eventName, ...args)</code> - raw event emitter, i.e. <code>emit('life:start')</code></li><li><code>emitAsync(eventName, ...args)</code> - same as <code>emit</code> but operates on next tick</li><li><code>notifyUI(level, message)</code> - generates and sends a notification which appears on the Bitfinex UI</li><li><code>cancelOrderWithDelay(state, delay, order)</code> - takes current algo state, delay in ms</li><li><code>cancelAllOrdersWithDelay(state, delay)</code> - cancels all active atomic orders on the AO state, delay in ms</li><li><code>submitOrderWithDelay(state, delay, order)</code> - takes current algo state, submits a new order, delay in ms</li><li><code>declareEvent(instance, host, eventName, path)</code> - declares an internal AO event, see section below</li><li><code>declareChannel(instance, host, channel, filter)</code> - declares a required data channel, see section below</li><li><code>updateState(instance, update)</code> - update the current state for an AO instance</li></ul><p>For more information, refer to the [helpers documentation.]{@link module:Helpers}</p><h3 id="custom-ao-event-handlers"><a class="header-anchor" href="#custom-ao-event-handlers">§</a> Custom AO Event Handlers</h3><p>To declare custom events to be triggered by the [<code>emitSelf</code>]{@link module:Helpers~emitSelf} or [<code>emitSelfAsync</code>]{@link module:Helpers~emitSelfAsync} helpers, use the [<code>declareEvent</code>]{@link module:Helpers~declareEvent} helper inside of the <code>declareEvents</code> meta method in order to register the event names on AO startup. For an example, see the [<code>Iceberg</code>]{@link module:Iceberg} event definition handler:</p><pre><code class="hljs language-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params">instance = {}, host</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { h = {} } = instance
  <span class="hljs-keyword">const</span> { declareEvent } = h

  <span class="hljs-comment">// All declared events are expected to be handled on the 'self' section, but can have any path/label</span>

  <span class="hljs-comment">// Map self:submit_order to the 'submit_order' handler</span>
  declareEvent(instance, host, <span class="hljs-string">'self:submit_order'</span>, <span class="hljs-string">'submit_order'</span>)

  <span class="hljs-comment">// Map self:interval_tick to the 'interval_tick' handler</span>
  declareEvent(instance, host, <span class="hljs-string">'self:interval_tick'</span>, <span class="hljs-string">'interval_tick'</span>)
}
</code></pre><p>Later, these events are triggered within other <code>Iceberg</code> event handlers, such as <code>submit_orders</code> within the <code>life:start</code> handler:</p><pre><code class="hljs language-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> (instance = {}) =&gt; {
  <span class="hljs-keyword">const</span> { h = {} } = instance
  <span class="hljs-keyword">const</span> { emitSelf } = h

  <span class="hljs-comment">// ...</span>

  <span class="hljs-keyword">await</span> emitSelf(<span class="hljs-string">'submit_orders'</span>)
}
</code></pre><h3 id="subscribing-to-data-channels"><a class="header-anchor" href="#subscribing-to-data-channels">§</a> Subscribing to Data Channels</h3><p>To subscribe to Bitfinex websocket API data channels, use the <code>declareChannel</code> helper within the <code>declareChannels()</code> meta method. Channel subscribe/unsubscribe calls will be handled automatically by the AO host during execution, with the relevant data being passed to the <code>data</code> section event handlers upon receival. For an example, see the <code>TWAP</code> channel declaration:</p><pre><code class="hljs language-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> (instance = {}, host) =&gt; {
  <span class="hljs-keyword">const</span> { h = {}, state = {} } = instance
  <span class="hljs-keyword">const</span> { args = {} } = state
  <span class="hljs-keyword">const</span> { symbol, priceTarget } = args
  <span class="hljs-keyword">const</span> { declareChannel } = h

  <span class="hljs-keyword">if</span> (hasTradeTarget(args)) {
    <span class="hljs-keyword">await</span> declareChannel(instance, host, <span class="hljs-string">'trades'</span>, { symbol })
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hasOBTarget(args)) {
    <span class="hljs-keyword">await</span> declareChannel(instance, host, <span class="hljs-string">'book'</span>, {
      symbol,
      <span class="hljs-attr">prec</span>: <span class="hljs-string">'R0'</span>,
      <span class="hljs-attr">len</span>: <span class="hljs-string">'25'</span>
    })
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`invalid price target <span class="hljs-subst">${priceTarget}</span>`</span>)
  }
}
</code></pre><h2 id="ping%2Fpong-order-type"><a class="header-anchor" href="#ping%2Fpong-order-type">§</a> Ping/Pong Order Type</h2><p>Ping/pong submits multiple ‘ping’ orders; once a ping order fills, an associated ‘pong’ order is submitted.</p><p>Multiple ping/pong pairs can be created by specifying an order count greater than 1, a suitable min/max ping price, and a pong distance. Multiple ping orders will be created between the specified min/max prices, with the associated pongs offset by the pong distance from the ping price.</p><p>Example:</p><pre><code class="hljs language-js"><span class="hljs-keyword">await</span> host.startAO(<span class="hljs-string">'bfx-ping_pong'</span>, {
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'tBTCUSD'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-number">0.5</span>,
  <span class="hljs-attr">orderCount</span>: <span class="hljs-number">5</span>,
  <span class="hljs-attr">pingMinPrice</span>: <span class="hljs-number">6000</span>,
  <span class="hljs-attr">pingMaxPrice</span>: <span class="hljs-number">6700</span>,
  <span class="hljs-attr">pongDistance</span>: <span class="hljs-number">300</span>,
  <span class="hljs-attr">submitDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">cancelDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">_margin</span>: <span class="hljs-literal">false</span>,
})
</code></pre><h2 id="iceberg-order-type"><a class="header-anchor" href="#iceberg-order-type">§</a> Iceberg Order Type</h2><p>Iceberg allows you to place a large order on the market while ensuring only a small part of it is ever filled at once. By enabling the ‘Excess As Hidden’ option, it is possible to offer up the remainder as a hidden order, allowing for minimal market disruption when executing large trades.</p><p>Example:</p><pre><code class="hljs language-js"><span class="hljs-keyword">await</span> host.startAO(<span class="hljs-string">'bfx-iceberg'</span>, {
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'tBTCUSD'</span>,
  <span class="hljs-attr">price</span>: <span class="hljs-number">21000</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-number">-0.5</span>,
  <span class="hljs-attr">sliceAmount</span>: <span class="hljs-number">-0.1</span>,
  <span class="hljs-attr">excessAsHidden</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">orderType</span>: <span class="hljs-string">'LIMIT'</span>,
  <span class="hljs-attr">submitDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">cancelDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">_margin</span>: <span class="hljs-literal">false</span>,
})
</code></pre><h2 id="twap-order-type"><a class="header-anchor" href="#twap-order-type">§</a> TWAP Order Type</h2><p>TWAP spreads an order out through time in order to fill at the time-weighted average price, calculated between the time the order is submitted to the final atomic order close.</p><p>The price can be specified as a fixed external target, such as the top bid/ask or last trade price, or as an explicit target which must be matched against the top bid/ask/last trade/etc.</p><p>Available price targets/explicit target conditions:</p><ul><li>OB side price (top bid/ask)</li><li>OB mid price</li><li>Last trade price</li></ul><p>Example:</p><pre><code class="hljs language-js"><span class="hljs-keyword">await</span> host.startAO(<span class="hljs-string">'bfx-twap'</span>, {
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'tBTCUSD'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-number">-0.5</span>,
  <span class="hljs-attr">sliceAmount</span>: <span class="hljs-number">-0.1</span>,
  <span class="hljs-attr">sliceInterval</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">priceDelta</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// max distance from price target to fulfill condition</span>
  <span class="hljs-attr">priceTarget</span>: <span class="hljs-number">16650</span>,
  <span class="hljs-attr">priceCondition</span>: TWAP.Config.PRICE_COND.MATCH_LAST,
  <span class="hljs-attr">tradeBeyondEnd</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">orderType</span>: <span class="hljs-string">'LIMIT'</span>,
  <span class="hljs-attr">submitDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">cancelDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">_margin</span>: <span class="hljs-literal">false</span>
})
</code></pre><h2 id="accumulate%2Fdistribute-order-type"><a class="header-anchor" href="#accumulate%2Fdistribute-order-type">§</a> Accumulate/Distribute Order Type</h2><p>Accumulate/Distribute allows you to break up a large order into smaller randomized chunks, submitted at regular or irregular intervals to minimise detection by other players in the market.</p><p>By enabling the ‘Await Fill’ option, the algorithm will ensure each component fills before submitting subsequent orders. Enabling the ‘Catch Up’ flag will cause the algorithm to ignore the slice interval for the next order if previous orders have taken longer than expected to fill, thereby ensuring the time-to-fill for the entire order is not adversely affected.</p><p>The price must be manually specified as <code>limitPrice</code> for <code>LIMIT</code> order types, or as a combination of a price offset &amp; cap for <code>RELATIVE</code> order types. <code>MARKET</code> A/D orders execute using <code>MARKET</code> atomic orders, and offer no price control.</p><p>For <code>RELATIVE</code> A/D orders, the price offset &amp; cap can both be set to one of the following:</p><ul><li>Top ask</li><li>Top bid</li><li>Orderbook mid price</li><li>Last trade price</li><li>Moving Average (configurable period, time frame, candle price)</li><li>Exponential Moving Average (configurable period, time frame, candle price)</li></ul><p>The period limit for moving average targets/caps is <code>240</code>, being the number of candles returned by the Bitfinex API when subscribing to a candle data channel.</p><p>Example:</p><pre><code class="hljs language-js"><span class="hljs-keyword">await</span> host.startAO(<span class="hljs-string">'bfx-accumulate_distribute'</span>, {
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'tBTCUSD'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-number">-0.2</span>,
  <span class="hljs-attr">sliceAmount</span>: <span class="hljs-number">-0.1</span>,
  <span class="hljs-attr">sliceInterval</span>: <span class="hljs-number">10000</span>,
  <span class="hljs-attr">intervalDistortion</span>: <span class="hljs-number">0.20</span>, <span class="hljs-comment">// %</span>
  <span class="hljs-attr">amountDistortion</span>: <span class="hljs-number">0.20</span>, <span class="hljs-comment">// %</span>
  <span class="hljs-attr">orderType</span>: <span class="hljs-string">'RELATIVE'</span>, <span class="hljs-comment">// MARKET, LIMIT, RELATIVE</span>
  <span class="hljs-attr">offsetType</span>: <span class="hljs-string">'ask'</span>,
  <span class="hljs-attr">offsetDelta</span>: <span class="hljs-number">-10</span>,
  <span class="hljs-attr">capType</span>: <span class="hljs-string">'bid'</span>,
  <span class="hljs-attr">capDelta</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">submitDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">cancelDelay</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">catchUp</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// if true &amp; behind, ignore slice interval (after prev fill)</span>
  <span class="hljs-attr">awaitFill</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// await current slice fill before continuing to next slice</span>
  <span class="hljs-attr">_margin</span>: <span class="hljs-literal">false</span>,
})
</code></pre><h2 id="ma-crossover"><a class="header-anchor" href="#ma-crossover">§</a> MA Crossover</h2><p>MA Crossover triggers either a MARKET or LIMIT order when two user-defined moving averages cross (configurable to use MA or EMA for either the long or short signals.)</p><p>Example:</p><pre><code class="hljs language-js"><span class="hljs-keyword">await</span> host.startAO(<span class="hljs-string">'bfx-ma_crossover'</span>, {
  <span class="hljs-attr">shortType</span>: <span class="hljs-string">'EMA'</span>,
  <span class="hljs-attr">shortEMATF</span>: <span class="hljs-string">'1m'</span>,
  <span class="hljs-attr">shortEMAPeriod</span>: <span class="hljs-string">'20'</span>,
  <span class="hljs-attr">shortEMAPrice</span>: <span class="hljs-string">'close'</span>,
  <span class="hljs-attr">longType</span>: <span class="hljs-string">'EMA'</span>,
  <span class="hljs-attr">longEMATF</span>: <span class="hljs-string">'1m'</span>,
  <span class="hljs-attr">longEMAPeriod</span>: <span class="hljs-string">'100'</span>,
  <span class="hljs-attr">longEMAPrice</span>: <span class="hljs-string">'close'</span>,
  <span class="hljs-attr">amount</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'tEOSUSD'</span>,
  <span class="hljs-attr">orderType</span>: <span class="hljs-string">'MARKET'</span>,
  <span class="hljs-attr">action</span>: <span class="hljs-string">'Buy'</span>,
  <span class="hljs-attr">_margin</span>: <span class="hljs-literal">false</span>,
})
</code></pre><h2 id="execution-via-the-bitfinex-ui"><a class="header-anchor" href="#execution-via-the-bitfinex-ui">§</a> Execution via the Bitfinex UI</h2><p>To execute these algo orders via the standard Bitfinex UI, see the <a href="https://github.com/bitfinexcom/bfx-hf-algo-server">bfx-hf-algo-server</a> repo, which uploads the relevant Order Form definitions and listens for preview/submit notifications on the bfx API to start algo orders with parameters taken from the UI order form.</p></div></div><!--
      <div id="bfx-oss-docs-footer-bar">
        <div id="bfx-oss-docs-footer-bar__container">
          <p>Copyright © 2013-2020 iFinex Inc. All rights reserved.</p>
        </div>
      </div>
      --></div><script type="text/javascript" src="js/vendor/debug.min.js"></script><script type="text/javascript" src="js/vendor/lodash.min.js"></script><script type="text/javascript" src="js/vendor/zepto.min.js"></script><script type="text/javascript" src="js/vendor/perfect-scrollbar.min.js"></script><script type="text/javascript" src="js/main.js"></script></body></html>